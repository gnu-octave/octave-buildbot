<div class="container">
  <style>
  div.logo {
    max-width: 45em;
  }
  div.logo img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 200px
  }
  ul.buildlist li {
    margin: 1em;
  }
  details.buildlist {
    max-width: 45em;
    border: 1px solid black;
  }
  details.buildlist summary {
    padding: 1em;
    background-color: khaki;
  }
  div.buildbot {
    margin: 2em;
  }
  div.buildbot a {
    color: blue;
  }
  div.buildbotentry {
    border: 1px solid black;
    padding: 5px;
  }
  .right {
    float: right;
  }
  /* https://docs.buildbot.net/latest/developer/results.html#build-result-codes */
  .color0 { background-color: #8d4;   } /* success */
  .color1 { background-color: orange; } /* warning */
  .color2 { background-color: #e88;   } /* failure */
  .color3 { background-color: white;  } /* skipped */
  .color4 { background-color: #ecc; } /* exception */
  .color5 { background-color: #ecc; } /* retry */
  .color6 { background-color: #ecc;   } /* cancelled */
  </style>
  <div class="logo">
    <img src="{{url_for('static', filename='octave.space.png')}}"
         alt="Buildbot Octave">
  </div>
  <h3>Recent GNU Octave builds</h3>

  {% for build in builds %}
  <details class="buildlist"{% if loop.index == 1 %} open{% endif %}>
    <summary>
      Octave <b>{{build.version}}</b>
      &nbsp;&nbsp;
      (hg id: <a target="_blank" href="{{config.repo_change_url}}/{{build.id}}">{{build.id}}</a>)
      &nbsp;&nbsp;
      {{build.date}}
    </summary>
    {%- macro do_final_list(files) -%}
    {% for key, values in files|dictsort %}
      {% for value in values %}
      {% if key == 'html' %}
        {% set value = value + '/' %}
      {% endif %}
        <a target="_blank" href="{{config.data_url}}/{{build.id}}/{{value}}">[{{key}}]</a>
      {% endfor %}
    {% endfor %}
    {%- endmacro %}
    {%- macro do_list(files) -%}
    <ul class="buildlist">
      {% for key, value in files|dictsort %}
      <li>
        <b>{{key}}</b>
        {% if key == 'octave-mxe' %}
          {{ do_list(value) }}
        {% elif key == 'unknown' %}
          {{ value }}
        {% else %}
          {{ do_final_list(value) }}
        {% endif %}
      </li>
      {% endfor %}
    </ul>
    {%- endmacro %}
    {{ do_list(build.files) }}
    <ul class="buildlist">
      <li>
        <a target="_blank" href="{{config.data_url}}/{{build.id}}/">[List of all files]</a>
      </li>
    </ul>
    <div class="buildbot">
      {% for bb in build.builds %}
      <div class="buildbotentry color{{bb.results}}">
        <a href="/#/builders/{{bb.builderid}}/builds/{{bb.number}}">{{bb.properties.buildername[0]}}/{{bb.number}}</a>
        <span class="right">{{bb.state_string}}</span>
      </div>
      {% endfor %}
    </div>
  </details>
  {% endfor %}

  <br><br>

  <p><b>Info:</b></p>
  <ul>
    <li>
      hg id:
      <a href="https://www.mercurial-scm.org/wiki/ChangeSetID">Mercurial (hg) changeset</a>
      identification at
      <a href="{{config.repo_url}}">{{config.repo_url}}</a>.
    </li>
    <li>
      Buildbot sources at
      <a href="https://github.com/gnu-octave/octave-buildbot/">https://github.com/gnu-octave/octave-buildbot/</a>.
    </li>
  </ul>

  <br><br>

</div>
